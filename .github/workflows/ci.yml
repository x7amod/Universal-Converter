name: Unit Tests

# Only run CI when code files change, ignore documentation and assets
on:
  push:
    branches: [ main, develop ]
    paths-ignore:
      - '**.md'
      - '**.txt'
      - '**.log'
      - '**.zip'
      - '**.crx'
      - '**.png'
      - '**.jpg'
      - '**.jpeg'
      - '**.gif'
      - '**.ico'
      - 'LICENSE'
      - '.gitignore'
      - 'build/**'
      - 'dist/**'
      - 'node_modules/**'
      - 'img/**'
      - 'docs/**'
      
  pull_request:
    branches: [ main ]
    paths-ignore:
      - '**.md'
      - '**.txt'
      - '**.log'
      - '**.zip'
      - '**.crx'
      - '**.png'
      - '**.jpg'
      - '**.jpeg'
      - '**.gif'
      - '**.ico'
      - 'LICENSE'
      - '.gitignore'
      - 'build/**'
      - 'dist/**'
      - 'node_modules/**'
      - 'img/**'
      - 'docs/**'

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Use Node.js 24.x
      uses: actions/setup-node@v4
      with:
        node-version: 24.x
        cache: 'npm'
        
    - name: Install dependencies
      run: npm ci
      
    - name: Validate extension structure
      run: npm run validate
      
    - name: Run unit tests
      run: npm test
      
    - name: Test extension build
      run: npm run build
      
    - name: Generate test coverage report
      run: |
        echo "Test coverage report:" > coverage.txt
        npm test >> coverage.txt 2>&1 || true
        
    - name: Upload test results
      uses: actions/upload-artifact@v4
      if: always()
      with:
        name: test-results-node-24
        path: |
          coverage.txt
          *.log

